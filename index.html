<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Sajara</title>
  <meta name="viewport" content="width=340, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=Reem+Kufi+Fun:wght@600&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-pink: #e85a8b;
      --light-pink: #ffe0ef;
      --soft-pink: #f6d0db;
      --offwhite: #fdf7f6;
      --text-dark: #aa2656;
      --text-soft: #9e406b;
      --border-pink: #e85a8b;
      --white: #fff;
    }
    body {
      font-family: 'Tajawal', Arial, sans-serif;
      background: var(--offwhite);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      position: relative;
    }
    .container {
      width: 340px;
      margin: 20px auto 0 auto;
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 0 7px #f5dce4;
      padding: 14px;
      min-height: 92vh;
      position: relative;
      padding-bottom: 34px !important;
      box-sizing: border-box;
    }
    h1 {
      color: var(--main-pink);
      text-align: center;
      font-style: italic;
      margin-top: 0;
      font-size: 1.6rem;
      font-family: 'Reem Kufi Fun', 'Tajawal', Arial, sans-serif;
      letter-spacing: 1px;
    }
    .header-row {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    .cart-btn {
      background: var(--light-pink);
      border: none;
      border-radius: 7px;
      width: 38px;
      height: 38px;
      cursor: pointer;
      position: relative;
      margin-left: 8px;
      transition: transform 0.2s;
    }
    .cart-count {
      position: absolute;
      left: 5px;
      top: 3px;
      color: var(--main-pink);
      font-weight: 700;
      font-size: 0.95rem;
    }
    .cart-btn.shake {
      animation: shake-cart 0.4s;
    }
    @keyframes shake-cart {
      0% { transform: translateX(0); }
      15% { transform: translateX(-4px); }
      35% { transform: translateX(4px); }
      55% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }
    .search {
      flex: 1;
      background: var(--light-pink);
      border: none;
      border-radius: 7px;
      padding: 8px;
      font-size: 1rem;
      color: var(--main-pink);
      outline: none;
      direction: rtl;
    }
    .product-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .product-card {
      background: var(--soft-pink);
      border-radius: 14px;
      min-height: 120px;
      padding: 8px 0 0 0;
      cursor: pointer;
      text-align: center;
      color: var(--main-pink);
      font-weight: 700;
      font-size: 1.05rem;
      transition: background 0.2s;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      border: 1.4px solid var(--main-pink);
    }
    .product-card:hover {
      background: var(--light-pink);
    }
    .product-img {
      width: 100%;
      height: 120px;
      border-radius: 14px;
      object-fit: cover;
      margin-bottom: 7px;
      margin-top: 6px;
      background: var(--white);
      border: 2px solid var(--main-pink);
      box-sizing: border-box;
      transition: border-radius 0.2s;
      display: block;
    }
    /* Cart Popup */
    .cart-popup {
      background: var(--light-pink);
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px #f7e5ea;
      position: relative;
      z-index: 10;
      font-size: 0.93rem;
      border: 1.5px solid var(--main-pink);
    }
    .cart-title {
      text-align: center;
      color: var(--main-pink);
      font-weight: 700;
      font-size: 1.05rem;
    }
    .cart-share {
      font-size: 0.8rem;
      color: var(--main-pink);
      font-weight: 400;
      margin-bottom: 3px;
    }
    .cart-total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 7px;
      font-size: 1rem;
      align-items: center;
    }
    .cart-total {
      color: var(--main-pink);
      font-weight: 700;
      font-size: 0.97rem;
    }
    .cart-btns-row {
      display: flex;
      gap: 8px;
    }
    .insta-btn {
      background: var(--main-pink);
      color: var(--white);
      border: none;
      font-weight: 700;
      border-radius: 8px;
      padding: 3px 8px;
      font-size: 0.92rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
      justify-content: center;
      min-width: 90px;
      user-select: none;
    }
    .copy-btn {
      background: #fff;
      color: var(--main-pink);
      border: 1.5px solid var(--main-pink);
      font-weight: 700;
      border-radius: 8px;
      padding: 3px 8px;
      font-size: 0.92rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      min-width: 90px;
      user-select: none;
      transition: background 0.18s;
    }
    .copy-btn:hover {
      background: var(--soft-pink);
    }
    .discount-row {
      font-size: 0.96rem;
      color: var(--main-pink);
      margin-bottom: 6px;
      margin-top: -2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .discount-code-box-cart {
      background: var(--white);
      border-radius: 8px;
      border: 2px solid var(--main-pink);
      padding: 0 2px 0 1px;
      font-size: 0.69rem;
      min-width: 35px;
      display: flex;
      align-items: center;
      gap: 1px;
      height: 13px;
      margin-bottom: 5px;
      margin-right: auto;
      margin-left: 0;
      width: fit-content;
      box-sizing: border-box;
      position: relative;
      z-index: 31;
    }
    .discount-input-cart {
      border: none;
      outline: none;
      font-size: 0.67rem;
      background: transparent;
      width: 29px;
      color: var(--main-pink);
      font-family: inherit;
      padding: 0;
      margin: 0 1px;
      height: 10px;
      line-height: 1;
    }
    .apply-discount-btn-cart {
      background: var(--main-pink);
      color: var(--white);
      border: none;
      border-radius: 4px;
      font-size: 0.68rem;
      font-family: inherit;
      font-weight: 700;
      padding: 0 2px;
      margin-right: 0;
      cursor: pointer;
      height: 11px;
      min-width: 17px;
      vertical-align: middle;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .discount-result-ok {
      color: #009a5b;
      font-size: 0.93rem;
      margin-right: 5px;
    }
    .discount-result-fail {
      color: #d90000;
      font-size: 0.93rem;
      margin-right: 5px;
    }
    .cart-item {
      display: flex;
      align-items: center;
      background: var(--soft-pink);
      border-radius: 18px;
      padding: 7px 6px 7px 2px;
      margin: 9px 0;
      font-size: 0.92rem;
      position: relative;
      box-shadow: 0 1px 5px #f7e5ea;
    }
    .cart-item-img {
      border-radius: 50%;
      width: 54px;
      height: 54px;
      object-fit: cover;
      margin-left: 10px;
      border: 2px solid var(--main-pink);
      background: var(--white);
      flex-shrink: 0;
      aspect-ratio: 1 / 1;
      box-sizing: border-box;
      display: block;
    }
    .cart-item-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
    }
    .cart-item-name {
      color: var(--main-pink);
      font-weight: 700;
      font-size: 1rem;
    }
    .cart-item-price,
    .cart-item-desc {
      color: var(--main-pink);
      font-size: 0.87rem;
      margin-top: 1px;
    }
    .cart-item-btns {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-right: 6px;
      align-items: center;
    }
    .cart-item-btn,
    .cart-item-btn-delete {
      background: var(--main-pink);
      color: var(--white);
      border: none;
      border-radius: 50%;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .cart-item-btn {
      border-radius: 4px;
      width: auto;
      height: auto;
      font-size: 0.85rem;
      padding: 2px 8px;
      background: var(--main-pink);
      margin-bottom: 1px;
      border-radius: 5px;
      width: 54px;
      height: 26px;
      justify-content: center;
    }
    .cart-item-btn-delete {
      background: #d9005e;
    }
    /* Edit Cart Item Popup */
    .edit-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(248,190,211,0.18);
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .edit-content {
      background: var(--white);
      border-radius: 14px;
      padding: 12px 10px;
      min-width: 215px;
      max-width: 245px;
      box-shadow: 0 4px 20px #f5dce4;
      position: relative;
      text-align: center;
      margin: auto;
    }
    .edit-close {
      position: absolute;
      top: 3px; left: 8px;
      background: none;
      border: none;
      font-size: 1.4rem;
      color: var(--main-pink);
      cursor: pointer;
    }
    .edit-img {
      width: 100%;
      height: 50px;
      border-radius: 12px;
      margin-bottom: 8px;
      object-fit: cover;
      background: var(--white);
      border: 2px solid var(--main-pink);
      aspect-ratio: 1 / 1;
      box-sizing: border-box;
      display: block;
    }
    .edit-btn {
      background: var(--main-pink);
      color: var(--white);
      border: none;
      border-radius: 7px;
      font-size: 1.02rem;
      font-weight: 700;
      padding: 7px 14px;
      margin-top: 8px;
      cursor: pointer;
      width: 100%;
    }
    .edit-input,
    .edit-select {
      border-radius: 6px;
      border: 1px solid var(--main-pink);
      margin-right: 5px;
      padding: 2px 4px;
      font-size: 0.97rem;
    }
    /* Product Details Popup */
    .popup-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(248,190,211,0.15);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup-overlay[style*="display: none"] {
      align-items: unset; justify-content: unset;
    }
    .popup-content {
      background: var(--white);
      border-radius: 14px;
      padding: 12px 10px;
      min-width: 215px;
      max-width: 245px;
      box-shadow: 0 4px 20px #f5dce4;
      position: relative;
      text-align: center;
      margin: auto;
    }
    .popup-close {
      position: absolute;
      top: 3px; left: 8px;
      background: none;
      border: none;
      font-size: 1.4rem;
      color: var(--main-pink);
      cursor: pointer;
    }
    .popup-img {
      width: 100%;
      height: 120px;
      border-radius: 12px;
      object-fit: cover;
      margin-bottom: 8px;
      background: var(--white);
      border: 2px solid var(--main-pink);
      box-sizing: border-box;
      display: block;
    }
    .popup-title {
      color: var(--main-pink);
      margin: 0;
      font-size: 1.11rem;
    }
    .popup-btn {
      background: var(--main-pink);
      color: var(--white);
      border: none;
      border-radius: 7px;
      font-size: 1.01rem;
      font-weight: 700;
      padding: 7px 14px;
      margin-top: 8px;
      cursor: pointer;
      width: 100%;
    }
    .popup-input,
    .popup-select {
      border-radius: 6px;
      border: 1px solid var(--main-pink);
      margin-right: 5px;
      padding: 2px 4px;
      font-size: 0.97rem;
    }
    /* Add-to-cart feedback popup and messages */
    .add-popup, .warn-popup, .confirm-popup, .edit-popup-ok {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--white);
      border: 2px solid var(--main-pink);
      color: var(--main-pink);
      font-weight: 700;
      font-size: 1.07rem;
      padding: 13px 22px;
      border-radius: 10px;
      box-shadow: 0 6px 32px #f7e5ea;
      z-index: 9999;
      display: none;
      text-align: center;
      pointer-events: auto;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .add-popup.show, .warn-popup.show, .confirm-popup.show, .edit-popup-ok.show {
      display: block;
      opacity: 1;
    }
    /* Confirm buttons */
    .confirm-btns {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-top: 13px;
    }
    .confirm-btn {
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 700;
      padding: 6px 18px;
      cursor: pointer;
      background: var(--main-pink);
      color: var(--white);
      transition: background 0.2s;
    }
    .confirm-btn.cancel {
      background: #f5b8c3;
      color: var(--main-pink);
    }
    /* Splash overlay */
    .splash-overlay {
      position: fixed;
      z-index: 100000;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: var(--soft-pink);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: opacity 0.45s;
    }
    .splash-title {
      font-family: 'Reem Kufi Fun', 'Tajawal', Arial, sans-serif;
      color: var(--main-pink);
      font-size: 2.5rem;
      margin-bottom: 30px;
      margin-top: 0;
      letter-spacing: 2.5px;
      text-shadow: 0 1px 10px #e9aabc7a;
      user-select: none;
    }
    .splash-btn {
      background: var(--main-pink);
      color: var(--white);
      font-family: 'Tajawal', Arial, sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      border: none;
      border-radius: 20px;
      padding: 14px 44px;
      cursor: pointer;
      box-shadow: 0 2px 15px #f5b8c3;
      transition: background 0.2s, transform 0.13s;
      margin-bottom: 8vh;
    }
    .splash-btn:active { background: #c93867; }
    .footer {
      width: 100vw;
      text-align: center;
      position: fixed;
      left: 0;
      bottom: 0;
      font-size: 0.82rem;
      color: var(--main-pink);
      opacity: 0.69;
      letter-spacing: 0.2px;
      font-family: 'Tajawal', Arial, sans-serif;
      z-index: 100001;
      pointer-events: none;
      user-select: none;
      background: none;
      line-height: 2.1;
    }
    @media (max-width: 380px) {
      .container { width: 96vw; }
      .popup-content, .edit-content { min-width: 80vw; max-width: 88vw; }
      .splash-title { font-size: 2rem;}
      .splash-btn { padding: 10px 20px; font-size: 1rem;}
    }
  </style>
</head>
<body>
  <div class="splash-overlay" id="splashScreen">
    <div class="splash-title">Sajara</div>
    <button class="splash-btn" id="startShopBtn">تسوق الآن</button>
  </div>
  <div class="container" id="mainContent" style="filter: blur(0);">
    <h1>Sajara</h1>
    <div class="header-row">
      <button class="cart-btn" id="cartBtn" aria-label="افتح عربة التسوق">
        <span class="cart-count" id="cartCount"></span>
        <svg width="23" height="23" fill="#e85a8b" viewBox="0 0 24 24">
          <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12L7.1 15h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49a1 1 0 00-.9-1.48h-15V4H2v2h2.21l3.6 7.59-1.35 2.44c-.2.36-.32.76-.32 1.18 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"/>
        </svg>
      </button>
      <input class="search" placeholder="....ابحث عن المنتج" />
    </div>
    <!-- Cart Popup -->
    <div class="cart-popup" id="cartPopup" style="display:none"></div>
    <!-- Products -->
    <div class="product-grid" id="productGrid"></div>
  </div>
  <div class="footer">website made by Webbie</div>

  <!-- Product Details Popup -->
  <div class="popup-overlay" id="productPopup" style="display:none">
    <div class="popup-content" id="popupContent"></div>
  </div>

  <!-- Edit Cart Item Popup -->
  <div class="edit-overlay" id="editCartPopup" style="display:none">
    <div class="edit-content" id="editContent"></div>
  </div>

  <!-- Add to cart feedback popup -->
  <div id="addCartPopup" class="add-popup">تمت الإضافة إلى السلة!</div>
  <!-- Warning popup for quantity and edit -->
  <div id="warnPopup" class="warn-popup">لا يمكنك إضافة كمية أكبر من المتوفر!</div>
  <!-- Edit success popup -->
  <div id="editOkPopup" class="edit-popup-ok">تم التعديل!</div>
  <!-- Discount popup -->
  <div id="discountResultPopup" class="add-popup">تم خصم ١٠٪</div>
  <!-- Confirm delete popup -->
  <div id="confirmPopup" class="confirm-popup">
    <div id="confirmMsg">هل أنت متأكد من الحذف؟</div>
    <div class="confirm-btns">
      <button class="confirm-btn" id="confirmYesBtn">نعم</button>
      <button class="confirm-btn cancel" id="confirmNoBtn">إلغاء</button>
    </div>
  </div>
  <audio id="clickSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b8c44.mp3"></audio>
  <script>
    // --- Splash Screen ---
    window.onload = function() {
      document.body.style.overflow = "hidden";
      document.getElementById('mainContent').style.filter = "blur(3px) grayscale(0.36)";
    };
    document.getElementById('startShopBtn').onclick = function() {
      playClick();
      document.getElementById('splashScreen').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('splashScreen').style.display = "none";
        document.getElementById('mainContent').style.filter = "";
        document.body.style.overflow = "";
      }, 420);
    };

    // --- بيانات المنتجات مع الصور الجديدة ---
    const products = [
      { id: 1, name: "منتج", price: 10, color: "أبيض",   sizes: ["S", "M", "L"], quantity: 7,  image: "https://ik.imagekit.io/2e1h7gr23/c2fe9a3f49e0876b6cd0c086865aba4c.jpg?updatedAt=1749824005479" },
      { id: 2, name: "منتج", price: 10, color: "أسود",   sizes: ["S", "L"],      quantity: 3,  image: "https://ik.imagekit.io/2e1h7gr23/e5b0b7fbc9d7168034bd54e3add3764c.jpg?updatedAt=1749824005486" },
      { id: 3, name: "منتج", price: 10, color: "أزرق",   sizes: ["M", "L"],      quantity: 5,  image: "https://ik.imagekit.io/2e1h7gr23/5cba34fac13da7192be7c9a3e1a07693.jpg?updatedAt=1749824008775" },
      { id: 4, name: "منتج", price: 10, color: "أحمر",   sizes: ["S", "M"],      quantity: 4,  image: "https://ik.imagekit.io/2e1h7gr23/35743b83afdc959b319a199b49dea1e4.jpg?updatedAt=1749824009094" },
      { id: 5, name: "منتج", price: 18, color: "رمادي",  sizes: ["M", "L", "XL"],quantity: 6,  image: "https://ik.imagekit.io/2e1h7gr23/de2210d45338ace660fe34c1c7381c7b.jpg?updatedAt=1749824009216" },
      { id: 6, name: "منتج", price: 20, color: "أزرق",   sizes: ["32", "34", "36"],quantity: 9,image: "https://ik.imagekit.io/2e1h7gr23/719a8065d8e786249315f5965d9965f9.jpg?updatedAt=1749824005200" },
      { id: 7, name: "منتج", price: 25, color: "وردي",   sizes: ["S", "M", "L"], quantity: 4,  image: "https://ik.imagekit.io/2e1h7gr23/6707bd98b559e9879c5b415bc8ca48bb.jpg?updatedAt=1749824005230" },
      { id: 8, name: "منتج", price: 35, color: "بني",    sizes: ["1"],           quantity: 3,  image: "https://ik.imagekit.io/2e1h7gr23/e398edaf4a052b37a155945d5a600167.jpg?updatedAt=1749824005348" },
      { id: 9, name: "منتج", price: 40, color: "ذهبي",   sizes: ["1"],           quantity: 8,  image: "https://ik.imagekit.io/2e1h7gr23/6037752d1af88c1531e864f18b24baf7.jpg?updatedAt=1749824005357" },
      { id: 10, name: "منتج", price: 30, color: "أبيض",  sizes: ["40", "41", "42", "43"],quantity: 10, image: "https://ik.imagekit.io/2e1h7gr23/3d9b5f18f8d1f49c7773a97cf8c4845f.jpg?updatedAt=1749824005117" },
      { id: 11, name: "منتج", price: 16, color: "بيج",   sizes: ["S", "M", "L"], quantity: 4,  image: "https://ik.imagekit.io/2e1h7gr23/bf7ea5c56e2149a8ef475f8b9764d2f4.jpg?updatedAt=1749824005139" },
      { id: 12, name: "منتج", price: 70, color: "أسود",  sizes: ["M", "L", "XL"],quantity: 2,  image: "https://ik.imagekit.io/2e1h7gr23/a05d163f489938667af9c82bae32d077.jpg?updatedAt=1749824005194" }
    ];

    let cart = [];
    let pendingDeleteIdx = null;
    let discount = { percent: 0, code: "" };
    const discountCodes = [
      { code: "G5jA0", percent: 10 },
      { code: "YHW2H", percent: 20 },
      { code: "yhw2h", percent: 20 },
      { code: "Yhw2h", percent: 20 },
      { code: "yHW2H", percent: 20 },
      { code: "YHW2h", percent: 20 }
    ];

    // --- صوت نقرة لطيفة ---
    function playClick() {
      const click = document.getElementById('clickSound');
      if (!click) return;
      try {
        click.currentTime = 0;
        click.volume = 0.35;
        click.play();
      } catch (e) {}
    }
    function addClickSoundToAll() {
      document.body.addEventListener('click', function(e) {
        let el = e.target;
        if (
          el.closest('.cart-btn, .cart-item-btn, .cart-item-btn-delete, .cart-item-btns, .insta-btn, .copy-btn, .popup-btn, .edit-btn, .confirm-btn, .edit-close, .popup-close, .product-card, .apply-discount-btn-cart, .splash-btn')
        ) {
          playClick();
        }
      }, true);
    }

    function renderProducts() {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = "";
      products.forEach(product => {
        const div = document.createElement('div');
        div.className = "product-card";
        div.innerHTML = `
          <img src="${product.image}" alt="${product.name}" class="product-img"/>
          <div>${product.name}</div>
          <div style="font-size:0.93rem;margin:4px 0">JD ${product.price}</div>
        `;
        div.onclick = () => openProductPopup(product);
        grid.appendChild(div);
      });
    }

    function renderCart() {
      const popup = document.getElementById('cartPopup');
      if (!popup) return;
      if (!window.cartOpen) {
        popup.style.display = "none";
        return;
      }
      popup.style.display = "block";
      let subtotal = cart.reduce((a, b) => a + b.price * b.quantity, 0);
      let discountValue = Math.round(subtotal * discount.percent) / 100;
      let total = subtotal - discountValue;
      let discountText = discount.percent > 0
        ? `<span class="discount-row">الخصم: -JD ${discountValue} (${discount.percent}%)</span>`
        : "";
      let codeBox = `
        <div class="discount-code-box-cart">
          <span style="font-size:0.62rem;">كود</span>
          <input class="discount-input-cart" id="discountInputCart" maxlength="8" placeholder="كود"/>
          <button class="apply-discount-btn-cart" id="applyDiscountBtnCart">تطبيق</button>
        </div>
      `;
      let html = `
        <div class="cart-title">
          عربة التسوق (${cart.length})
          <div class="cart-share">مشاركة العربة</div>
        </div>
        ${codeBox}
        <hr style="border:1px solid #f5b8c3;"/>
        <div class="cart-total-row">
          <span class="cart-total">المجموع الكلي: JD ${total}</span>
          <div class="cart-btns-row">
            <a class="insta-btn" id="instaBtn" href="https://www.instagram.com/sajara_store" target="_blank">
              الطلب عبر الانستا
            </a>
            <button class="copy-btn" id="copyOrderBtn" type="button">نسخ الطلب</button>
          </div>
        </div>
        ${discountText}
      `;
      if (cart.length === 0) {
        html += `<div style="color:var(--main-pink)">لا يوجد منتجات في العربة</div>`;
      } else {
        cart.forEach((item, idx) => {
          html += `
            <div class="cart-item">
              <img src="${item.image}" alt="${item.name}" class="cart-item-img" />
              <div class="cart-item-details">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-price">JD ${item.price}</div>
                <div class="cart-item-desc">
                  اللون: ${item.color} | الحجم: ${item.size} | الكمية: ${item.quantity}
                </div>
              </div>
              <div class="cart-item-btns">
                <button class="cart-item-btn" onclick="editCartItem(${idx});event.stopPropagation();">تعديل</button>
                <button class="cart-item-btn-delete" onclick="showDeleteConfirm(${idx});event.stopPropagation();" title="حذف">
                  <svg width="14" height="16" viewBox="0 0 16 16" fill="#fff"><path d="M5.5 1a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1V2H15a1 1 0 0 1 0 2h-1v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4H1a1 1 0 0 1 0-2h3.5V1zm1 0V2h3V1h-3zm-4 3v11a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4H2zm2.5 2a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zm3 0a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zm3 0a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5z"/></svg>
                </button>
              </div>
            </div>
          `;
        });
      }
      popup.innerHTML = html;
      document.getElementById('cartCount').textContent = cart.length > 0 ? cart.length : "";
      document.getElementById('applyDiscountBtnCart').onclick = applyDiscountCodeCart;
      document.getElementById('discountInputCart').onkeydown = function(e) {
        if (e.key === "Enter") applyDiscountCodeCart();
      };

      // وظيفة نسخ الطلب فقط
      setTimeout(function() { // Fixes issues with the DOM not being ready
        var copyBtn = document.getElementById('copyOrderBtn');
        if (copyBtn) {
          copyBtn.onclick = function() {
            if (cart.length === 0) return;
            let subtotal = cart.reduce((a, b) => a + b.price * b.quantity, 0);
            let discountValue = Math.round(subtotal * discount.percent) / 100;
            let total = subtotal - discountValue;
            let msg = "مرحبا اود طلب»»»\n\nسعر الكلي للطلبية: JD " + total + "\n";
            cart.forEach(item => {
              msg += "\nالمنتج: (" + item.name + ")\n";
              msg += "نوعه: (" + item.color + ")\n";
              msg += "سعره: (" + item.price + ")\n";
              msg += "كميته: (" + item.quantity + ")\n";
            });

            // استخدام textarea لضمان التوافق مع جميع المتصفحات
            var tempInput = document.createElement("textarea");
            tempInput.style.position = "fixed";
            tempInput.style.opacity = "0";
            tempInput.value = msg;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
              document.execCommand('copy');
              showDiscountResultPopup("تم نسخ الطلب!");
            } catch(e){
              alert("حدث خطأ أثناء النسخ، يرجى النسخ اليدوي.");
            }
            document.body.removeChild(tempInput);
          };
        }
      }, 0);

      // عند الطلب عبر الانستا: نسخ المنتجات وإظهار نافذة إشعار وفتح الانستا
      setTimeout(function() {
        var instaBtn = document.getElementById('instaBtn');
        if(instaBtn) {
          instaBtn.onclick = function(e) {
            e.preventDefault();
            if (cart.length === 0) return window.open("https://www.instagram.com/sajara_store", "_blank");
            let subtotal = cart.reduce((a, b) => a + b.price * b.quantity, 0);
            let discountValue = Math.round(subtotal * discount.percent) / 100;
            let total = subtotal - discountValue;
            let msg = "مرحبا اود طلب»»»\n\nسعر الكلي للطلبية: JD " + total + "\n";
            cart.forEach(item => {
              msg += "\nالمنتج: (" + item.name + ")\n";
              msg += "نوعه: (" + item.color + ")\n";
              msg += "سعره: (" + item.price + ")\n";
              msg += "كميته: (" + item.quantity + ")\n";
            });

            // استخدام textarea لضمان التوافق مع جميع المتصفحات
            var tempInput = document.createElement("textarea");
            tempInput.style.position = "fixed";
            tempInput.style.opacity = "0";
            tempInput.value = msg;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
              document.execCommand('copy');
              showDiscountResultPopup("تم نسخ الطلب! الصقه في الانستا");
            } catch(e){
              alert("حدث خطأ أثناء النسخ، يرجى النسخ اليدوي.");
            }
            document.body.removeChild(tempInput);

            setTimeout(function() {
              window.open("https://www.instagram.com/sajara_store", "_blank");
            }, 850);
          };
        }
      }, 0);
    }

    // ... باقي السكربت كما هو ...
    function openProductPopup(product) {
      const overlay = document.getElementById('productPopup');
      const content = document.getElementById('popupContent');
      overlay.style.display = "flex";
      overlay.scrollTop = 0;
      let sizeOptions = product.sizes.map(size =>
        `<option value="${size}">${size}</option>`
      ).join('');
      content.innerHTML = `
        <button class="popup-close" onclick="closeProductPopup()">×</button>
        <img src="${product.image}" alt="${product.name}" class="popup-img"/>
        <h2 class="popup-title">${product.name}</h2>
        <div style="margin:7px 0;color:var(--main-pink);font-size:1.01rem;">JD ${product.price}</div>
        <div style="font-size:0.95rem;color:var(--main-pink);">اللون: ${product.color}</div>
        <div style="font-size:0.95rem;color:var(--main-pink);">المتوفر: ${product.quantity}</div>
        <div style="font-size:0.93rem;color:var(--main-pink);">
          الحجم:
          <select id="popupSize" class="popup-select">
            ${sizeOptions}
          </select>
        </div>
        <div style="font-size:0.93rem;color:var(--main-pink);margin:7px 0;">
          الكمية:
          <input id="popupQty" type="number" min="1" max="${product.quantity}" value="1" class="popup-input" style="width:38px"/>
        </div>
        <button class="popup-btn" id="addToCartBtn">أضف إلى السلة</button>
      `;
      document.getElementById('addToCartBtn').onclick = function() {
        addToCartFromPopup(product);
      };
    }
    function closeProductPopup() {
      document.getElementById('productPopup').style.display = "none";
    }
    function addToCartFromPopup(product) {
      const size = document.getElementById('popupSize').value;
      const qty = parseInt(document.getElementById('popupQty').value, 10);
      if (!size || isNaN(qty) || qty < 1 || qty > product.quantity) {
        showWarnPopup("لا يمكنك إضافة كمية أكبر من المتوفر!");
        return;
      }
      const idx = cart.findIndex(
        item => item.id === product.id && item.size === size
      );
      if (idx !== -1) {
        if (cart[idx].quantity + qty > product.quantity) {
          showWarnPopup("لا يمكنك إضافة كمية أكبر من المتوفر!");
          return;
        }
        cart[idx].quantity += qty;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          color: product.color,
          size: size,
          quantity: qty,
          image: product.image,
          maxQuantity: product.quantity
        });
      }
      closeProductPopup();
      renderCart();
      showAddCartPopup();
      animateCartIcon();
    }

    function showAddCartPopup() {
      const popup = document.getElementById('addCartPopup');
      popup.classList.add('show');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 1200);
    }
    function showWarnPopup(msg) {
      const popup = document.getElementById('warnPopup');
      popup.textContent = msg;
      popup.classList.add('show');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 1550);
    }
    function showEditOkPopup() {
      const popup = document.getElementById('editOkPopup');
      popup.classList.add('show');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 1200);
    }
    function showDiscountResultPopup(msg) {
      const popup = document.getElementById('discountResultPopup');
      popup.textContent = msg;
      popup.classList.add('show');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 1400);
    }
    function animateCartIcon() {
      const icon = document.getElementById('cartBtn');
      icon.classList.add('shake');
      setTimeout(() => {
        icon.classList.remove('shake');
      }, 400);
    }
    document.getElementById('cartBtn').onclick = function() {
      window.cartOpen = !window.cartOpen;
      renderCart();
    };
    document.getElementById('productPopup').onclick = function(e) {
      if (e.target === this) closeProductPopup();
    };
    function showDeleteConfirm(idx) {
      pendingDeleteIdx = idx;
      const popup = document.getElementById('confirmPopup');
      popup.classList.add('show');
    }
    document.getElementById('confirmYesBtn').onclick = function() {
      if (pendingDeleteIdx !== null) {
        cart.splice(pendingDeleteIdx, 1);
        pendingDeleteIdx = null;
        renderCart();
      }
      document.getElementById('confirmPopup').classList.remove('show');
    };
    document.getElementById('confirmNoBtn').onclick = function() {
      pendingDeleteIdx = null;
      document.getElementById('confirmPopup').classList.remove('show');
    };
    function editCartItem(idx) {
      const item = cart[idx];
      const overlay = document.getElementById('editCartPopup');
      const content = document.getElementById('editContent');
      overlay.style.display = "flex";
      const prod = products.find(p=>p.id===item.id);
      let sizeOptions = prod.sizes.map(size =>
        `<option value="${size}" ${size === item.size ? "selected" : ""}>${size}</option>`
      ).join('');
      content.innerHTML = `
        <button class="edit-close" onclick="closeEditCartPopup()">×</button>
        <img src="${prod.image}" alt="${prod.name}" class="edit-img"/>
        <h2 class="popup-title">${prod.name}</h2>
        <div style="margin:7px 0;color:var(--main-pink);font-size:1.01rem;">JD ${prod.price}</div>
        <div style="font-size:0.95rem;color:var(--main-pink);">اللون: ${prod.color}</div>
        <div style="font-size:0.95rem;color:var(--main-pink);">المتوفر: ${prod.quantity}</div>
        <div style="font-size:0.93rem;color:var(--main-pink);">
          الحجم:
          <select id="editSize" class="edit-select">
            ${sizeOptions}
          </select>
        </div>
        <div style="font-size:0.93rem;color:var(--main-pink);margin:7px 0;">
          الكمية:
          <input id="editQty" type="number" min="1" max="${prod.quantity}" value="${item.quantity}" class="edit-input" style="width:38px"/>
        </div>
        <button class="edit-btn" id="saveEditBtn">حفظ التعديلات</button>
      `;
      document.getElementById('saveEditBtn').onclick = function() {
        const newSize = document.getElementById('editSize').value;
        const newQty = parseInt(document.getElementById('editQty').value, 10);
        if (!newSize || isNaN(newQty) || newQty < 1) {
          showWarnPopup("لا يمكن التعديل بسبب الكمية!");
          return;
        }
        const prodAvailable = products.find(p=>p.id===item.id);
        if (!prodAvailable) {
          showWarnPopup("لا يمكن التعديل بسبب الكمية!");
          return;
        }
        const maxQty = prodAvailable.quantity;
        const sameIdx = cart.findIndex(
          (it,i) => i !== idx && it.id === item.id && it.size === newSize
        );
        if (sameIdx !== -1) {
          let sumQty = cart[sameIdx].quantity + newQty;
          if (sumQty > maxQty) {
            showWarnPopup("لا يمكن التعديل بسبب الكمية!");
            return;
          }
          cart[sameIdx].quantity = sumQty;
          cart.splice(idx, 1);
        } else {
          if (newQty > maxQty) {
            showWarnPopup("لا يمكن التعديل بسبب الكمية!");
            return;
          }
          item.size = newSize;
          item.quantity = newQty;
        }
        closeEditCartPopup();
        renderCart();
        showEditOkPopup();
      };
    }
    function closeEditCartPopup() {
      document.getElementById('editCartPopup').style.display = "none";
    }
    document.getElementById('editCartPopup').onclick = function(e) {
      if (e.target === this) closeEditCartPopup();
    };
    function applyDiscountCodeCart() {
      let code = document.getElementById('discountInputCart').value.trim();
      let found = discountCodes.find(dc => dc.code === code);
      if (found) {
        discount.percent = found.percent;
        discount.code = found.code;
        renderCart();
        showDiscountResultPopup(`تم خصم ${discount.percent}٪`);
      } else if (code === "") {
        discount.percent = 0;
        discount.code = "";
        renderCart();
        showDiscountResultPopup("تم حذف الكود");
      } else {
        showDiscountResultPopup("الكود خاطئ");
      }
    }
    renderProducts();
    renderCart();
    addClickSoundToAll();
  </script>
</body>
</html>